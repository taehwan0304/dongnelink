{% extends "base.html" %}

{% block title %}ë™ë„¤ìƒí™œ - {{ post.title }}{% endblock %}

{% block content %}

<section class="layout layout-detail">
    <div class="layout-main">
        <a href="/" class="back-link">â† ë™ë„¤ í”¼ë“œë¡œ ëŒì•„ê°€ê¸°</a>

        <article class="card post-card">
            <div class="post-header">
                <div>
                    <h1 class="post-title">{{ post.title }}</h1>
                    <div class="post-meta">
                        <span>{{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                        {% if post.author %}
                            <span>Â· {{ post.author.username }}</span>
                        {% endif %}
                    </div>
                </div>
                <form action="/post/{{ post.id }}/like" method="post">
                    <button type="submit" class="btn-like">
                        â¤ï¸ ì¢‹ì•„ìš”
                        <span class="btn-like-count">{{ post.like_count or 0 }}</span>
                    </button>
                </form>
            </div>

            {% if post.image_path %}
                <div class="post-image-wrap">
                    <img src="{{ post.image_path }}" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€" class="post-image" />
                </div>
            {% endif %}

            <div class="post-content">
                {{ post.content | replace('\n', '<br>') | safe }}
            </div>
        </article>

        <section class="card comment-card">
            <div class="card-title-row">
                <h2>ğŸ’¬ ëŒ“ê¸€</h2>
                <span class="card-caption">
                    ì´ ê¸€ì— ëŒ€í•œ ì´ì›ƒë“¤ì˜ ìƒê°ì„ ë“¤ì–´ë³´ì„¸ìš”.
                </span>
            </div>

            {% if post.comments %}
                <div class="comment-list">
                    {% for c in post.comments %}
                        <div class="comment-item">
                            <div class="comment-head">
                                <div class="comment-user">
                                    <div class="avatar-circle small">
                                        {% if c.author %}
                                            {{ c.author.username[0]|upper }}
                                        {% else %}
                                            ?
                                        {% endif %}
                                    </div>
                                    <div>
                                        <div class="comment-name">
                                            {% if c.author %}
                                                {{ c.author.username }}
                                            {% else %}
                                                ìµëª…
                                            {% endif %}
                                        </div>
                                        <div class="comment-date">
                                            {{ c.created_at.strftime('%Y-%m-%d %H:%M') }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p class="comment-content">
                                {{ c.content | replace('\n', '<br>') | safe }}
                            </p>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="empty-text">
                    ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”.
                </p>
            {% endif %}

            <div class="comment-form-wrap">
                <h3>âœï¸ ëŒ“ê¸€ ë‚¨ê¸°ê¸°</h3>

                {% if not user %}
                    <p class="info-text">
                        ëŒ“ê¸€ ì‘ì„±ì€ <a href="/login">ë¡œê·¸ì¸</a> í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
                    </p>
                {% endif %}

                <form action="/post/{{ post.id }}/comment" method="post" class="form-vertical">
                    <textarea
                      name="comment_content"
                      placeholder="ì´ ê¸€ì„ ë³´ê³  ëŠë‚€ ì , ì¶”ê°€ë¡œ ë‚˜ëˆ„ê³  ì‹¶ì€ ë™ë„¤ ì´ì•¼ê¸°ë¥¼ ì ì–´ì£¼ì„¸ìš”."
                      required
                      {% if not user %}disabled{% endif %}
                    ></textarea>
                    <button
                      type="submit"
                      class="btn-primary"
                      {% if not user %}disabled{% endif %}
                    >
                        ëŒ“ê¸€ ë“±ë¡
                    </button>
                </form>
            </div>
        </section>
    </div>

    <aside class="layout-side">
        <div class="card side-card">
            <h3>ê¸€ ì •ë³´</h3>
            <p class="info-text">
                ì´ ê¸€ì€ ë™ë„¤ ì»¤ë®¤ë‹ˆí‹° í”„ë¡œí† íƒ€ì…ì—ì„œ ì‘ì„±ëœ ê²Œì‹œê¸€ì…ë‹ˆë‹¤.
                ì‹¤ì œ ì„œë¹„ìŠ¤ ë””ìì¸ ëª©ì—…ì—ë„ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
            </p>
        </div>
    </aside>
</section>

{% endblock %}
