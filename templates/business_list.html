{% extends "base.html" %}
{% block title %}{{ business.name }} - 동네링크{% endblock %}

{% block extra_head %}
<style>
  .biz-header h1 {
    margin: 0;
    font-size: 24px;
    font-weight: 800;
    color: var(--green-dark);
  }

  .biz-header p {
    margin: 6px 0 0;
    font-size: 13px;
    color: var(--text-sub);
  }

  .biz-meta {
    font-size: 12px;
    color: var(--text-sub);
    margin-top: 6px;
  }

  .biz-actions {
    margin-top: 10px;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .review-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  }

  .badge-status {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 11px;
    background: #EDF2F7;
    color: #4A5568;
  }

  .badge-approved {
    background: #C6F6D5;
    color: #22543D;
  }

  .badge-paid {
    background: #BEE3F8;
    color: #2B6CB0;
  }

  .review-item {
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
  }

  .review-item:last-child {
    border-bottom: none;
  }

  .rating-line {
    font-size: 13px;
    margin-top: 4px;
  }
</style>
{% endblock %}

{% block header %}
<div class="biz-header" style="padding: 20px 20px 0;">
  <h1>{{ business.name }}</h1>
  <p>{{ business.sido }} {{ business.sigungu }} {{ business.dong }} · {{ business.category }}</p>
</div>
{% endblock %}

{% block content %}
<div class="card">
  {% if business.image_url %}
    <img src="{{ business.image_url }}" alt="이미지"
         style="width:100%; max-height:260px; object-fit:cover; border-radius:14px; margin-bottom:12px;">
  {% endif %}

  <p style="font-size:14px; margin-top:4px;">{{ business.description }}</p>

  <p class="biz-meta">
    등록자: {{ business.owner }} /
    상태:
    {% if business.approved %}
      <span class="badge-status badge-approved">운영자 승인 완료</span>
    {% else %}
      <span class="badge-status">승인 대기중</span>
    {% endif %}
    {% if business.paid %}
      <span class="badge-status badge-paid">입점비 결제 완료</span>
    {% endif %}
  </p>

  {% if user and (business.owner == user or request.cookies.get('is_admin') == '1') %}
  <div class="biz-actions">
    <a href="/business/{{ business.id }}/edit" class="btn-outline">업체 정보 수정</a>

    <form action="/business/{{ business.id }}/delete" method="post" style="display:inline;">
      <button type="submit" class="btn-outline"
              onclick="return confirm('정말 삭제하시겠습니까? 삭제 후에는 되돌릴 수 없습니다.');">
        업체 삭제
      </button>
    </form>

    {% if not business.paid %}
    <form action="/business/{{ business.id }}/pay-entry" method="post" style="display:inline;">
      <button type="submit" class="btn-primary">입점비 결제 (모의)</button>
    </form>
    {% endif %}
  </div>
  {% endif %}
</div>

<div class="card">
  <div class="review-header">
    <h2 style="margin:0; font-size:18px;">리뷰</h2>
    {% if review_count > 0 %}
      <div style="font-size:13px; color:var(--text-sub);">
        ⭐ 평균 {{ '%.1f'|format(avg_rating) }}점 · {{ review_count }}개 리뷰
      </div>
    {% else %}
      <div style="font-size:13px; color:var(--text-sub);">
        아직 리뷰가 없습니다.
      </div>
    {% endif %}
  </div>

  {% if reviews %}
    <div style="margin-top:10px;">
      {% for r in reviews %}
      <div class="review-item">
        <div style="font-size:13px; font-weight:600;">
          ⭐ {{ r.rating }}점 · {{ r.username }}
        </div>
        <div style="font-size:13px; margin-top:3px;">
          {{ r.comment }}
        </div>
      </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if user %}
  <form method="post" action="/business/{{ business.id }}/review" style="margin-top:14px;">
    <div style="margin-bottom:8px;">
      <label style="font-size:13px;">평점 (1~5)</label>
      <input type="number" name="rating" min="1" max="5" value="5"
             style="padding:4px 6px; font-size:13px; width:80px;">
    </div>
    <div style="margin-bottom:8px;">
      <label style="font-size:13px;">코멘트</label><br>
      <textarea name="comment" rows="3" style="width:100%; font-size:13px;"></textarea>
    </div>
    <button class="btn-primary" type="submit">리뷰 남기기</button>
  </form>
  {% else %}
  <p style="margin-top:10px; font-size:13px; color:var(--text-sub);">
    리뷰를 작성하려면 <a href="/auth/login" style="color:var(--green-dark); font-weight:600;">로그인</a>이 필요합니다.
  </p>
  {% endif %}
</div>
{% endblock %}
